<ion-header [translucent]="true">
  <app-header-inner-page
    [text]="'Raise a Request'"
    [text_second]="subPageName"
  ></app-header-inner-page>
</ion-header>

<ion-content [fullscreen]="true">
  <div class="w-full flex items-start justify-start mt-2 ml-3">
    <ion-icon
      name="arrow-back-circle"
      size="large"
      class="text-[var(--ion-color-primary)] size-12"
      [routerLink]="['/raise-a-request-page-main']"
    ></ion-icon>
  </div>
  <div class="flex flex-col w-full px-4 mb-28">
    <div
      id="default_form"
      *ngIf="!['Coach Registration Form', 'Pet Registration Form', 'Appeal Parking'].includes(subPageName)"
    >
      <!-- Name of Resident Applying -->
      <div class="w-full mb-2">
        <app-input-component
          [id]="formDefaultDisplay[0].id"
          [type]="'text'"
          [typeAction]="'Type'"
          [labelChild1]="formDefaultDisplay[0].text"
          [value]="formDefaultDisplay[0].value"
          [disabled]="formDefaultDisplay[0].disabled"
        ></app-input-component>
      </div>
      <!-- Flex Row for the rest of the inputs -->
      <div class="flex flex-row justify-between">
        <div class="w-1/2 pr-1">
          <app-input-component
            [id]="formDefaultDisplay[1].id"
            [type]="'text'"
            [typeAction]="'Type'"
            [labelChild1]="formDefaultDisplay[1].text"
            [value]="formDefaultDisplay[1].value"
            [disabled]="formDefaultDisplay[1].disabled"
          ></app-input-component>
        </div>
        <div class="w-1/2 pl-1">
          <app-input-component
            [id]="formDefaultDisplay[2].id"
            [type]="'text'"
            [typeAction]="'Type'"
            [labelChild1]="formDefaultDisplay[2].text"
            [value]="formDefaultDisplay[2].value"
            [disabled]="formDefaultDisplay[2].disabled"
          ></app-input-component>
        </div>
      </div>
      <div *ngIf="subPageName === 'Access Card Form'; else notAccessCard">
        <div class="flex flex-row justify-between mt-2">
          <div class="w-1/2 pr-1">
            <app-input-component
              [id]="formDefaultDisplay[3].id"
              [type]="'text'"
              [typeAction]="'Type'"
              [labelChild1]="formDefaultDisplay[3].text"
              [value]="formDefaultDisplay[3].value"
              [disabled]="formDefaultDisplay[3].disabled"
            ></app-input-component>
          </div>
          <div class="w-1/2 pl-1">
            <app-input-component
              [id]="formDefaultDisplay[4].id"
              [type]="'text'"
              [typeAction]="'Type'"
              [labelChild1]="formDefaultDisplay[4].text"
              [value]="formDefaultDisplay[4].value"
              [disabled]="formDefaultDisplay[4].disabled"
            ></app-input-component>
          </div>
        </div>
      </div>
      <ng-template #notAccessCard>
        <div class="w-full mt-2">
          <app-input-component
            [id]="formDefaultDisplay[3].id"
            [type]="'text'"
            [typeAction]="'Type'"
            [labelChild1]="formDefaultDisplay[3].text"
            [value]="formDefaultDisplay[3].value"
            [disabled]="formDefaultDisplay[3].disabled"
          ></app-input-component>
        </div>
      </ng-template>
    </div>

    <div id="content">
      <div *ngIf="subPageName === 'Access Card Form'">
        <div class="flex flex-col mt-2">
          <h2 class="text-sm font-bold">What purpose you applying this?</h2>
          <div class="flex flex-row space-x-2 items-start my-2 w-full">
            <app-radio-check-input-case
              [type]="'radio'"
              [id]="'replacement'"
              [name]="'purpose'"
              [text]="'Replacement'"
              [value]="'replacement'"
              [checkedText]="selectedOptionCard === 'replacement'"
              (valueEmit)="onChangePurpose($event)"
            ></app-radio-check-input-case>
            <app-radio-check-input-case
              [type]="'radio'"
              [id]="'new_application'"
              [name]="'purpose'"
              [text]="'New Application'"
              [value]="'new_application'"
              [checkedText]="selectedOptionCard === 'new_application'"
              (valueEmit)="onChangePurpose($event)"
            ></app-radio-check-input-case>
          </div>
        </div>

        <!-- Replacement -->
        <div class="w-full mt-2" *ngIf="selectedOptionCard === 'replacement'">
          <div class="w-full">
            <div
              *ngIf="expectedCards.length > 0"
              class="flex flex-row justify-start mb-1"
            >
              <p class="text-base font-bold text-start">
                Which Card Would you want a replacement for?
              </p>
            </div>
            <div class="flex flex-row mt-1 w-full">
              <table
                *ngIf="expectedCards.length > 0"
                class="table-auto border-collapse border border-gray-300 w-full text-sm text-left bg-white"
              >
                <thead>
                  <tr class="bg-gray-200 text-gray-700">
                    <th
                      class="border border-gray-300 px-4 py-2 w-16 cw-3:text-[11px]"
                    ></th>
                    <th
                      class="border border-gray-300 px-4 py-2 cw-3:text-[11px]"
                    >
                      Card Number
                    </th>
                    <th
                      class="border border-gray-300 px-4 py-2 cw-3:text-[11px]"
                    >
                      Assigned Resident Name
                    </th>
                    <th
                      class="border border-gray-300 px-4 py-2 cw-3:text-[11px]"
                    >
                      Status
                    </th>
                  </tr>
                </thead>
                <tbody>
                  <tr *ngFor="let card of expectedCards">
                    <td class="border border-gray-300 px-4 py-2 text-center">
                      <input
                        id="card_data_{{card.access_card_id}}"
                        (change)="onCardSelect(card)"
                        name="card"
                        type="checkbox"
                        class="w-4 h-4 cw-3:w-2 cw-3:h-2"
                        [checked]="formAccessCard.access_card_replacement_id === card.access_card_id"
                      />
                    </td>
                    <td
                      class="border border-gray-300 px-4 py-2 text-gray-700 cw-3:text-[11px]"
                    >
                      {{ card.access_card_number }}
                    </td>
                    <td
                      class="border border-gray-300 px-4 py-2 text-gray-700 cw-3:text-[11px]"
                    >
                      {{ card.assigned_resident_name }}
                    </td>
                    <td
                      class="border border-gray-300 px-4 py-2 text-gray-700 cw-3:text-[11px]"
                    >
                      {{ card.access_card_status }}
                    </td>
                  </tr>
                </tbody>
              </table>
              <ng-container *ngIf="expectedCards.length === 0">
                <p class="text-gray-700">
                  Now there are still no cards or no one has been approved yet.
                  <u
                    (click)="onChangePurpose({click: true, value: 'replacement'})"
                    class="text-blue-500 underline"
                    >Make one now</u
                  >
                  or wait until approve
                </p>
              </ng-container>
            </div>
          </div>
          <div class="w-full mb-2">
            <app-input-component
              [id]="'reason_for_replacement'"
              [type]="'text'"
              [typeAction]="'Type'"
              [labelChild1]="'Reason for replacement'"
              [value]="formAccessCard.reason_for_replacement"
              (eventEmitter)="onReplacementChange($event)"
            ></app-input-component>
          </div>
        </div>

        <!-- New Application -->
        <div
          class="w-full mt-2"
          *ngIf="selectedOptionCard === 'new_application'"
        >
          <div class="w-full">
            <div class="flex flex-row justify-start mb-1">
              <p class="text-base font-bold text-start">
                Who are you applying for?
              </p>
            </div>
            <div class="flex flex-row mt-1">
              <table
                class="table-auto border-collapse border border-gray-300 w-full text-sm text-left bg-white"
              >
                <thead>
                  <tr class="bg-gray-200 text-gray-700">
                    <th
                      class="border border-gray-300 px-4 py-2 w-16 cw-3:text-[11px]"
                    ></th>
                    <th
                      class="border border-gray-300 px-4 py-2 cw-3:text-[11px]"
                    >
                      Assigned resident name
                    </th>
                  </tr>
                </thead>
                <tbody>
                  <tr *ngFor="let fam of expectedFamily">
                    <td class="border border-gray-300 px-4 py-2 text-center">
                      <input
                        id="card_data_member_or_family_{{fam.family_id}}"
                        (change)="onNewCardSelect(fam.family_id)"
                        name="new_card"
                        type="checkbox"
                        class="w-4 h-4 cw-3:w-2 cw-3:h-2"
                        [checked]="formAccessCard.family_ids === fam.family_id"
                      />
                    </td>
                    <td
                      class="border border-gray-300 px-4 py-2 text-gray-700 cw-3:text-[11px]"
                    >
                      <label for="card_data_member_or_family_{{fam.family_id}}"
                        >{{ fam.family_name }} , {{ fam.member_type }}</label
                      >
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>

      <div *ngIf="subPageName === 'Apply Overnight Form'">
        Apply Overnight Form
      </div>

      <div *ngIf="subPageName === 'Bicycle Tag Form'">Bicycle Tag Form</div>

      <div *ngIf="subPageName === 'Coach Registration Form'">
        Coach Registration Form
        <div *ngIf="formNextCoach">Coach Registration Form 2</div>
      </div>

      <div *ngIf="subPageName === 'Move Permit Form'">Move Permit Form</div>

      <div *ngIf="subPageName === 'Pet Registration Form'">
        Pet Registration Form
      </div>

      <div *ngIf="subPageName === 'Renovation Work Form'">
        Renovation Work Form
      </div>

      <div *ngIf="subPageName === 'Appeal Parking'">Appeal Parking</div>
    </div>

    <div
      id="amount"
      class="w-full mt-2"
      *ngIf="subPageName !== 'Pet Registration Form' && subPageName !== 'Appeal Parking' && subPageName !== 'Coach Registration Form' && subPageName !== 'Appeal Parking'"
    >
      <div *ngIf="amountType.isRequirePayment">
        <div class="w-full flex flex-row justify-between items-center mb-2">
          <div class="flex flex-row justify-start">
            <p class="text-sm font-bold">Include GST</p>
          </div>
          <div class="flex items-center ml-4">
            <input
              readonly
              disabled
              id="is_include_GST"
              type="checkbox"
              [(ngModel)]="amountType.isIncludeGST"
              class="w-7 h-7 accent-[#10421D] text-[#10421D] bg-gray-100 border-gray-300 focus:bg-[#10421D] rounded dark:bg-gray-700 dark:border-gray-600"
            />
          </div>
        </div>
        <app-input-component
          [id]="'amount_payable'"
          [type]="'text'"
          [typeAction]="'Type'"
          [labelChild1]="'Amount Payable'"
          [value]="amountType.amountTotal"
          [disabled]="true"
        ></app-input-component>
      </div>
    </div>

    <div
      class="flex flex-row mt-4 text-sm"
      *ngIf="subPageName !== 'Coach Registration Form' && subPageName !== 'Appeal Parking'"
    >
      <label class="mr-1 rounded font-bold flex items-center">
        <input
          type="checkbox"
          [checked]="agreementChecked"
          [(ngModel)]="agreementChecked"
          [ngModelOptions]="{standalone: true}"
          class="text-[var(--ion-color-primary)] rounded mr-1.5"
        />
        <p>
          I agree to the&nbsp;<u
            class="text-blue-400"
            (click)="presentModalAgreement()"
            >terms and condition</u
          >
        </p>
      </label>
    </div>

    <div
      *ngIf="subPageName !== 'Coach Registration Form' && subPageName !== 'Appeal Parking'"
    >
      <button
        [disabled]="!agreementChecked"
        [ngClass]="agreementChecked ? 'bg-[var(--ion-color-primary)] text-white' : 'bg-gray-300 text-gray-500'"
        class="mt-2 w-full text-base rounded h-12 font-bold"
        (click)="onSubmit()"
      >
        Submit for Approval
      </button>
    </div>
  </div>
</ion-content>

<ion-footer>
  <app-botton-nav-bar></app-botton-nav-bar>
</ion-footer>

<ion-content [fullscreen]="true">
  <div class="absolute z-50 mt-5 ml-2">
    <ion-icon
      name="arrow-back-circle"
      size="large"
      class="text-[var(--ion-color-primary)] size-12 clickable-element"
      [routerLink]="['']"
    ></ion-icon>
  </div>
  <div class="absolute inset-0 overflow-hidden -z-10">
    <!-- Fallback background untuk iOS yang bermasalah -->
    <div class="absolute inset-0 video-fallback object-cover h-full w-full">
      <img
        alt="iFS360 logo"
        class="w-full h-full opacity-20 object-cover"
        src="assets/tes_back_wztgzm.gif"
      />
    </div>
  </div>
  <div class="p-4 h-full w-full flex flex-col justify-center items-center">
    <div
      class="w-full rounded-lg login-container"
      style="position: relative; z-index: 10"
    >
      <div
        class="pb-4 space-y-4 flex flex-col justify-center items-center"
        style="position: relative; z-index: 15"
      >
        <img alt="iFS360 logo" class="w-48 h-36" src="assets/logoIFS.png" />
        <div class="text-center mt-4">
          <h2 class="font-bold text-[var(--ion-color-primary)] text-xl">
            Welcome To
          </h2>
          <p class="font-bold text-[var(--ion-color-primary)] text-3xl">
            iFS360 APP
          </p>
        </div>
        <div class="space-y-2 w-full" style="position: relative; z-index: 15">
          <div>
            <input
              type="email"
              name="email"
              id="email"
              class="!border !border-gray-300 text-gray-900 !rounded-lg block w-full p-3.5 text-sm clickable-element"
              placeholder="Email or Phone"
              [value]="existUser.login"
              (change)="onLoginChange($event)"
            />
          </div>
          <div>
            <div class="relative">
              <input
                id="hs-toggle-password"
                [type]="showPassword"
                class="py-3.5 pl-4 pr-12 block w-full !border !border-gray-200 !rounded-lg text-sm clickable-element focus:border-blue-500 focus:ring-blue-500"
                placeholder="**************"
                [value]="existUser.password"
                (change)="onPasswordChange($event)"
              />
              <button
                (click)="onToggleShowPassword()"
                type="button"
                class="absolute top-0 right-0 h-full flex items-center justify-center w-10 text-gray-400 hover:text-gray-600 focus:outline-none clickable-element"
                style="
                  position: absolute !important;
                  top: 50% !important;
                  right: 8px !important;
                  transform: translateY(-50%) !important;
                  z-index: 10 !important;
                  background: transparent !important;
                  border: none !important;
                  padding: 0 !important;
                  width: 24px !important;
                  height: 24px !important;
                  display: flex !important;
                  align-items: center !important;
                  justify-content: center !important;
                  -webkit-tap-highlight-color: transparent;
                "
              >
                <svg
                  *ngIf="showPassword == 'password'"
                  class="size-5"
                  width="24"
                  height="24"
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                >
                  <path d="M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z"></path>
                  <circle cx="12" cy="12" r="3"></circle>
                </svg>
                <svg
                  *ngIf="showPassword == 'text'"
                  class="size-5"
                  width="24"
                  height="24"
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                >
                  <path d="M9.88 9.88a3 3 0 1 0 4.24 4.24"></path>
                  <path
                    d="M10.73 5.08A10.43 10.43 0 0 1 12 5c7 0 10 7 10 7a13.16 13.16 0 0 1-1.67 2.68"
                  ></path>
                  <path
                    d="M6.61 6.61A13.526 13.526 0 0 0 2 12s3 7 10 7a9.74 9.74 0 0 0 5.39-1.61"
                  ></path>
                  <line x1="2" x2="22" y1="2" y2="22"></line>
                </svg>
              </button>
            </div>
          </div>
          <div class="flex items-center justify-between">
            <div class="flex flex-row items-center justify-center">
              <div class="flex items-center h-5">
                <input
                  id="remember"
                  aria-describedby="remember"
                  type="checkbox"
                  class="w-4 h-4 border border-gray-300 rounded bg-gray-50 focus:ring-3 focus:ring-primary-300 dark:bg-gray-700 dark:border-gray-600 dark:focus:ring-primary-600 dark:ring-offset-gray-800 clickable-element"
                />
              </div>
              <div class="ml-1 text-xs">
                <label
                  for="remember"
                  class="text-gray-500 dark:text-gray-300 clickable-element"
                  style="position: relative; z-index: 20; cursor: pointer"
                  >Stay logged in</label
                >
              </div>
            </div>
            <a
              class="text-xs font-medium text-blue-500 clickable-element"
              (click)="showModalForgotPassword()"
              style="
                position: relative;
                z-index: 20;
                cursor: pointer;
                -webkit-tap-highlight-color: transparent;
              "
              >Forgot password?</a
            >
          </div>
          <ion-button
            fill="clear"
            class="fslp-button !rounded-lg"
            [ngClass]="(existUser.login && existUser.password) ? 'bg-[var(--ion-color-primary)] text-white' : 'bg-gray-100 text-gray-400'"
            (click)="loginResident()"
          >
            LOG IN
          </ion-button>
          <!-- <button
            type="submit"
            class="w-full font-medium !rounded-lg text-sm px-5 py-3.5 text-center !mt-6 clickable-element"
            [ngClass]="(existUser.login && existUser.password) ? 'bg-[var(--ion-color-primary)] text-white' : 'bg-gray-100 text-gray-300'"
            (click)="loginResident()"
            style="
              position: relative;
              z-index: 20;
              -webkit-tap-highlight-color: transparent;
              -webkit-appearance: none;
              appearance: none;
            "
          >
            Log in
          </button> -->
          <p class="text-sm font-light text-gray-500 dark:text-gray-400 mt-2">
            Don't have an account yet?
            <a
              [routerLink]="['/register']"
              class="font-medium text-blue-500 clickable-element"
              style="position: relative; z-index: 20; cursor: pointer"
              >Register</a
            >
          </p>
        </div>
      </div>
    </div>
  </div>

  <!-- Loading Modal dengan iOS fixes -->
  <div
    class="modal-overlay"
    *ngIf="waitingResponseLoginApi"
    style="z-index: 9999"
  ></div>
  <div class="modal" *ngIf="waitingResponseLoginApi" style="z-index: 10000">
    <div
      class="p-4 rounded-lg w-full max-w-xs text-center"
      [ngClass]="{'animate-popup': !isAnimating, 'animate-popdown': isAnimating}"
      style="position: relative; z-index: 10001"
    >
      <div class="flex justify-center items-center h-full">
        <img
          alt="iFS360 logo"
          height="60"
          src="https://res.cloudinary.com/dkxor4kjf/image/upload/v1748331834/loader_ix4dhd.gif"
          class="w-36 h-36"
          style="z-index: 11000"
        />
      </div>
    </div>
  </div>

  <!-- Forgot Password Modal -->
  <ion-modal
    id="forgot-password-modal"
    [isOpen]="showForgotPasswordModal"
    (didDismiss)="closeRejectModal()"
  >
    <ng-template>
      <div class="wrapper">
        <div class="w-full text-center">
          <video
            autoplay
            loop
            muted
            playsinline
            webkit-playsinline
            width="300"
            height="300"
          >
            <source
              src="https://res.cloudinary.com/dkxor4kjf/video/upload/v1749453409/Animation_-_1749453252648_aruvnu.webm"
              type="video/mp4"
            />
            Your browser does not support the video tag.
          </video>
          <h2>
            The forgot password service is currently unavailable. Please contact
            your administrator for assistance.
          </h2>
        </div>
      </div>
    </ng-template>
  </ion-modal>
</ion-content>
